<!doctype html>
<html>
  <head>
    <title>WebRTC Test</title>
    <style>
      body {
        background: #111;
        color: white;
        text-align: center;
      }
      video {
        width: 640px;
        height: 480px;
        background: black;
      }
    </style>
  </head>
  <body>
    <h2>WebRTC Audio-Correct Streaming</h2>
    <button onclick="start()">Start</button>
    <video id="video" autoplay playsinline controls></video>

    <script>
      async function start() {
        const pc = new RTCPeerConnection();

        pc.ontrack = (e) => {
          document.getElementById("video").srcObject = e.streams[0];
        };

        pc.addTransceiver("audio", { direction: "recvonly" });
        pc.addTransceiver("video", { direction: "recvonly" });

        const offer = await pc.createOffer();
        await pc.setLocalDescription(offer);

        const res = await fetch("/offer", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            sdp: offer.sdp,
            type: offer.type,
          }),
        });

        const answer = await res.json();
        await pc.setRemoteDescription(answer);
      }
    </script>
  </body>
</html>
